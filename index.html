<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">


    <title>Giphy</title>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-sm-2"></div>

            <div class="col-sm-8">
                <h1>Fun with Gifs</h1>
                <!-- Rendered Buttons will get Dumped Here  -->
                <div id="buttons-view"></div>

                <form id="topic-form">
                    <label for="topic-input">Add a Topic</label>
                    <input type="text" id="topic-input">
                    <br>

                    <!-- Button triggers new topic to be added -->
                    <input id="add-topic" type="submit" value="Add a Topic">
                </form>

                <!-- Gifs will Get Dumped Here -->
                <div id="gifs-view"></div>

            </div>

            <div class="col-sm-2"></div>
        </div>


    </div>

    <script src="https://code.jquery.com/jquery.js"></script>


    <script type="text/javascript" src="assets/javascript/script.js"></script>

    <script type="text/javascript">

        // Initial array of topics
        var topics = [
            "Real Housewives",
            "Parks and Rec",
            "Muppets",
            "SNL",
            "Tina Fey",
            "Amy Poehler",
            "Kristen Wiig",
            "Kate McKinnon",
            "Otters",
            "Puppies",
            "Frasier"
        ];

        // Variables related to the GiphY API

        var APIkey = "q9CGcggx5BEpVZZ63u4a2I817X5LVIvy";
        var sampleURL = "http://api.giphy.com/v1/gifs/search?q=SNL&api_key=q9CGcggx5BEpVZZ63u4a2I817X5LVIvy&limit=5";


        // Function for displaying the gifs
        function displayGifs() {

            var category = $(this).attr("data-name");

            var queryURL = "http://api.giphy.com/v1/gifs/search?q=" + category + "&api_key=" + APIkey + "&limit=10";


            // Creating an AJAX call for the specific category button being clicked
            $.ajax({
                url: queryURL,
                method: "GET"
            }).then(function (response) {
                console.log(queryURL);
                console.log(response);

                $("#gifs-view").empty();

                for (var i = 0; i < response.data.length; i++) {

                    // Check to see that the correct data is being pulled
                    console.log(response.data[i].rating);
                    console.log(response.data[i].images.original.url);
                    console.log(response.data[i].images.original_still.url);

                    // Create local variables for that data
                    var rating = response.data[i].rating;
                    var stillGif = response.data[i].images.original_still.url;
                    var animatedGif = response.data[i].images.original.url;

                    // Create a well div for the image and the rating
                    var wellDiv = $("<div>");
                    wellDiv.addClass("well well-lg");
                    wellDiv.attr("id", "articleDiv-" + i);
                    $("#gifs-view").append(wellDiv);

                    // Attach the content to the appropriate well
                    if (response.data[i].rating != "null") {
                        $("#articleDiv-" + i).append("Rating: " + rating);
                    }

                    // Create an image tag for each of the gifs with all the different attributes
                    var gifImg = $("<img>");
                    gifImg.addClass("gif");
                    gifImg.attr("data-state", "still");
                    gifImg.attr("data-still", stillGif);
                    gifImg.attr("data-animate", animatedGif);
                    gifImg.attr("src", stillGif);

                    // Attach the gifs to the divs on the webpage
                    $("#articleDiv-" + i).append(gifImg);
                }
            });
        }

        // Function for changing gifs from still to animated
        $(document).on("click", ".gif", function () {

            // Local variables that collect the attribute data
            var state = $(this).attr("data-state");
            var animateVal = $(this).attr("data-animate");
            var stillVal = $(this).attr("data-still");

            // Check the variable's data state and then switch it from still to animate and change the src attribute from still to animate
            if (state === "still") {
                $(this).attr({
                    src: animateVal,
                    "data-state": "animate"
                });
            } else {
                $(this).attr({
                    src: stillVal,
                    "data-state": "still"
                });
            }
        });


        // Function for displaying buttons
        function renderButtons() {

            // Deleting the category buttons prior to adding new category buttons
            $("#buttons-view").empty();

            // Looping through the array of topics
            for (var i = 0; i < topics.length; i++) {

                // Code that creates the HTML that is added to the webpage
                var newBtn = $("<button>");
                newBtn.addClass("topic-btn");
                newBtn.attr("data-name", topics[i]);
                newBtn.text(topics[i]);

                // add that new HTML to the buttons section of the webpage
                $("#buttons-view").append(newBtn);
            }
        }

        // Function for adding new topic buttons
        $("#add-topic").on("click", function (event) {

            // prevent page from reloading
            event.preventDefault();

            // This grabs the new topic
            var newTopic = $("#topic-input").val().trim();
            // then adds the topic to the array
            topics.push(newTopic);

            // this regenerates all the buttons from the array (instead of just adding a new one)
            renderButtons();
        });

        // When you click a button, that loads all the gifs from the function above
        $(document).on("click", ".topic-btn", displayGifs);

        // This function needs to be called when the page loads to load the buttons in the intial array
        renderButtons();


    </script>

</body>

</html>